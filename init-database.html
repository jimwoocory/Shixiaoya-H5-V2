<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–½å°é›…æ¿æ - æ•°æ®åº“åˆå§‹åŒ–</title>
    <script src="https://web.sdk.qcloud.com/tcb-js-sdk/1.10.10/tcb.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .success { color: green; }
        .error { color: red; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ—„ï¸ æ–½å°é›…æ¿ææ•°æ®åº“åˆå§‹åŒ–</h1>
    
    <div class="log" id="log">
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥åˆå§‹åŒ–æ•°æ®åº“...</p>
    </div>
    
    <button class="btn" onclick="initDatabase()">ğŸš€ åˆå§‹åŒ–æ•°æ®åº“</button>
    <button class="btn" onclick="createSampleData()">ğŸ“¦ åˆ›å»ºç¤ºä¾‹æ•°æ®</button>
    <button class="btn" onclick="testConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
    
    <script>
        // åˆå§‹åŒ– CloudBase
        const tcb = window.tcb;
        const app = tcb.init({
            env: 'shixiaoya-h5-v1-6g5yuo5c2842bfb3'
        });
        
        const db = app.database();
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<p class="${className}">${new Date().toLocaleTimeString()} - ${message}</p>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function testConnection() {
            log('ğŸ”— æµ‹è¯• CloudBase è¿æ¥...');
            try {
                const result = await db.collection('test').limit(1).get();
                log('âœ… CloudBase è¿æ¥æˆåŠŸï¼', 'success');
            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function initDatabase() {
            log('ğŸ—„ï¸ å¼€å§‹åˆå§‹åŒ–æ•°æ®åº“...');
            
            const collections = ['categories', 'products', 'inquiries', 'cases', 'users'];
            
            for (const collectionName of collections) {
                try {
                    log(`ğŸ“ åˆ›å»ºé›†åˆ: ${collectionName}`);
                    // å°è¯•å‘é›†åˆæ·»åŠ ä¸€ä¸ªä¸´æ—¶æ–‡æ¡£æ¥åˆ›å»ºé›†åˆ
                    await db.collection(collectionName).add({
                        _temp: true,
                        createdAt: new Date()
                    });
                    log(`âœ… é›†åˆ ${collectionName} åˆ›å»ºæˆåŠŸ`, 'success');
                } catch (error) {
                    log(`âŒ åˆ›å»ºé›†åˆ ${collectionName} å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            log('ğŸ‰ æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼', 'success');
        }
        
        async function createSampleData() {
            log('ğŸ“¦ å¼€å§‹åˆ›å»ºç¤ºä¾‹æ•°æ®...');
            
            try {
                // åˆ›å»ºåˆ†ç±»æ•°æ®
                log('ğŸ“‚ åˆ›å»ºäº§å“åˆ†ç±»...');
                const categories = [
                    {
                        name: 'å®æœ¨æ¿æ',
                        slug: 'solid-wood',
                        description: 'ä¼˜è´¨å®æœ¨æ¿æï¼Œç¯ä¿å¥åº·ï¼Œçº¹ç†è‡ªç„¶',
                        sort: 1,
                        isActive: true,
                        createdAt: new Date()
                    },
                    {
                        name: 'äººé€ æ¿æ',
                        slug: 'engineered-wood',
                        description: 'é«˜å“è´¨äººé€ æ¿æï¼Œæ€§èƒ½ç¨³å®šï¼Œç”¨é€”å¹¿æ³›',
                        sort: 2,
                        isActive: true,
                        createdAt: new Date()
                    },
                    {
                        name: 'è£…é¥°æ¿æ',
                        slug: 'decorative-board',
                        description: 'ç²¾ç¾è£…é¥°æ¿æï¼Œç¾è§‚å®ç”¨ï¼Œè£…ä¿®é¦–é€‰',
                        sort: 3,
                        isActive: true,
                        createdAt: new Date()
                    }
                ];
                
                for (const category of categories) {
                    await db.collection('categories').add(category);
                }
                log('âœ… åˆ†ç±»æ•°æ®åˆ›å»ºå®Œæˆ', 'success');
                
                // åˆ›å»ºäº§å“æ•°æ®
                log('ğŸ“¦ åˆ›å»ºäº§å“æ•°æ®...');
                const products = [
                    {
                        name: 'ä¼˜è´¨æ©¡æœ¨æ¿',
                        slug: 'premium-oak-board',
                        description: 'è¿›å£æ©¡æœ¨åˆ¶ä½œï¼Œè´¨åœ°åšç¡¬ï¼Œçº¹ç†ç¾è§‚ï¼Œé€‚ç”¨äºé«˜ç«¯å®¶å…·åˆ¶ä½œ',
                        price: 299.00,
                        originalPrice: 399.00,
                        specifications: {
                            thickness: '18mm',
                            size: '1220x2440mm',
                            grade: 'E0çº§',
                            moisture: '8-12%'
                        },
                        features: ['ç¯ä¿E0çº§', 'é˜²æ½®å¤„ç†', 'çº¹ç†æ¸…æ™°', 'è´¨åœ°åšç¡¬'],
                        categoryId: 'solid-wood',
                        isHot: true,
                        isNew: false,
                        stock: 100,
                        sort: 1,
                        isActive: true,
                        createdAt: new Date()
                    },
                    {
                        name: 'å¤šå±‚å®æœ¨æ¿',
                        slug: 'multi-layer-plywood',
                        description: 'å¤šå±‚å®æœ¨èƒ¶åˆæ¿ï¼Œç»“æ„ç¨³å®šï¼Œä¸æ˜“å˜å½¢ï¼Œé€‚åˆå„ç§è£…ä¿®éœ€æ±‚',
                        price: 189.00,
                        originalPrice: 229.00,
                        specifications: {
                            thickness: '15mm',
                            size: '1220x2440mm',
                            grade: 'E1çº§',
                            layers: '9å±‚'
                        },
                        features: ['ç»“æ„ç¨³å®š', 'ä¸æ˜“å˜å½¢', 'æ¡é’‰åŠ›å¼º', 'é˜²æ½®æ€§å¥½'],
                        categoryId: 'engineered-wood',
                        isHot: true,
                        isNew: true,
                        stock: 200,
                        sort: 2,
                        isActive: true,
                        createdAt: new Date()
                    }
                ];
                
                for (const product of products) {
                    await db.collection('products').add(product);
                }
                log('âœ… äº§å“æ•°æ®åˆ›å»ºå®Œæˆ', 'success');
                
                // åˆ›å»ºæ¡ˆä¾‹æ•°æ®
                log('ğŸ—ï¸ åˆ›å»ºæ¡ˆä¾‹æ•°æ®...');
                const cases = [
                    {
                        title: 'ä¸Šæµ·æŸé«˜ç«¯ä½å®…é¡¹ç›®',
                        slug: 'shanghai-luxury-residence',
                        description: 'é‡‡ç”¨ä¼˜è´¨æ©¡æœ¨æ¿æï¼Œæ‰“é€ é«˜ç«¯ä½å®…ç©ºé—´ï¼Œå±•ç°è‡ªç„¶æœ¨è´¨çº¹ç†çš„é­…åŠ›',
                        location: 'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒº',
                        area: '300ã¡',
                        projectType: 'ä½å®…è£…ä¿®',
                        materials: ['ä¼˜è´¨æ©¡æœ¨æ¿', 'å¤šå±‚å®æœ¨æ¿'],
                        clientName: 'å¼ å…ˆç”Ÿ',
                        completedAt: new Date('2024-10-15'),
                        isActive: true,
                        sort: 1,
                        createdAt: new Date()
                    }
                ];
                
                for (const caseItem of cases) {
                    await db.collection('cases').add(caseItem);
                }
                log('âœ… æ¡ˆä¾‹æ•°æ®åˆ›å»ºå®Œæˆ', 'success');
                
                log('ğŸ‰ ç¤ºä¾‹æ•°æ®åˆ›å»ºå®Œæˆï¼', 'success');
                
            } catch (error) {
                log(`âŒ åˆ›å»ºç¤ºä¾‹æ•°æ®å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æµ‹è¯•è¿æ¥
        window.onload = function() {
            log('ğŸš€ æ–½å°é›…æ¿ææ•°æ®åº“åˆå§‹åŒ–å·¥å…·å·²åŠ è½½');
            testConnection();
        };
    </script>
</body>
</html>